<?php
		///////////////////////////////////////////////////////
		// --> DOMedia <--> 2001/02 <--> vis|wall <--  //
		///////////////////////////////////////////////////////
		//																//
		// MainGroup   : Interface                             //
		//																//
		// Name			: Module - NIDS Logging            //
		// Date			: 28.02.2002							//
		// Comment  	: Network Intrusion Detection	//
		//																//
		///////////////////////////////////////////////////////
        
		// -------------------------------------
		// | Open NIDS Logging DB			   |
		// -------------------------------------
		// | Last Change : 28.02.2002       |
		// -------------------------------------
		// | Status : Enabled                   |
		// -------------------------------------
		function open_db_nids()
		{
			$sql_db_nids = new sql_db_nids;
            mysql_connect($sql_db_nids->sql_db_host, $sql_db_nids->sql_db_username, $sql_db_nids->sql_db_password) or die ("Kann keine Verbindung zur Datenbank herstellen");
            mysql_select_db($sql_db_nids->sql_db_name) or die ("Die Datenbank wurde nicht gefunden");
		}
        
		// -------------------------------------
		// | Add TBF Entry (Sub,Main)       |
		// -------------------------------------
		// | Last Change : 10.01.2002       |
		// -------------------------------------
		// | Status : Enabled                   |
		// -------------------------------------
		function add_tbf($section, $section2, $tablename, $tablename2, $sid)
		{
            # Get Highest Priority
        	$result = mysql_query("select * from ".$tablename." order by id") or die(mysql_error());
            $number = mysql_num_rows($result);
			
			# Create new Default Entry #
			$data = "'','0','0','1500','64','0','100','0','Empty','0'";
			$fields = "id,rate,burst,latency_limit,mpu,peakrate,mtu,iid,name,status";
			$query = mysql_query("insert into ".$tablename." (".$fields.") values(".$data.")") or die(mysql_error());
			
			# Show Strategies (Default Mode)
            show_tbf($section, $section2, $tablename);
		}
        
        // -------------------------------------
		// | Delete NAT Entry (Sub,Main)   |
		// -------------------------------------
		// | Last Change : 10.01.2002       |
		// -------------------------------------
		// | Status : Enabled                   |
		// -------------------------------------
		function delete_tbf($section, $section2, $tablename, $tablename2, $sid)
		{
            $result_delete = mysql_query("delete from ".$tablename." where(id=\"".$sid."\")");
			show_tbf($section, $section2, $tablename);
		}
		
		/*
		* +-------------------------------------------+
		* | Edit Squid Entry								|
		* +-------------------------------------------+
		* | Last Change : 25.02.2002       			|
		* +-------------------------------------------+
		* | Status : Enabled                   			|
		* +-------------------------------------------+
		*/
		function edit_squid($section, $section2, $tablename, $sid)
		{
			# Open Database #
			$result = mysql_query("select * from ".$tablename." where(id='".$sid."')");
			$number = mysql_num_rows($result);
			
			# Read and Display Database Entries #
			$row = mysql_fetch_array($result);
			
			# Check if Information is already submitted #
			if (!isset($GLOBALS['rsubmit']))
			{
				echo "		<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" height=\"23px\">\n";
				echo "			<tr valign=\"top\">\n";
				echo "				<td align=\"left\" width=\"44px\" height=\"23px\" bgcolor=\"#E2E3DF\">\n";
				echo "					<img src=\"./images/tpx.gif\" width=\"44px\" height=\"23px\" border=\"0\"></td>\n";
				echo "				<td align=\"left\" height=\"23px\" bgcolor=\"#E2E3DF\">\n";
				echo " 	  				".$section2." | <i>".$tablename."</i> (".$sid.") &nbsp;</td>\n";
				echo "				<td align=\"left\" height=\"23px\" bgcolor=\"#E2E3DF\">\n";
				echo "					<img src=\"./images/tpx.gif\" width=\"200px\" height=\"23px\" border=\"0\"></td>\n";
				echo "			</tr>\n";
				echo "		</table>\n";
				
				echo "		<form method=\"post\" action=\"".$PHP_SELF."?module=".$section."&action=edit\" name=\"submitform\">";
				echo "		<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n";
				echo "			<tr>\n";
				echo "				<td height=\"20px\" colspan=\"2\">\n";
				echo "					<img src=\"./images/tpx.gif\" id=\"blank\" border=\"0\" width=\"1px\" height=\"20px\"></td>\n";
				echo "			</tr>\n";
				echo "			<tr>\n";
				echo "				<td align=\"left\" width=\"40px\">\n";
				echo "					<img src=\"./images/tpx.gif\" width=\"40px\" height=\"1px\" border=\"0\"></td>\n";
				echo "				<td align=\"left\">\n";
				
				echo "<TABLE cellSpacing=1 cellPadding=0 width=\"480\" border=0>\n";
				echo "<TBODY>\n";
				echo "<TR bgcolor=\"#565656\">\n";
				echo "<TD vAlign=bottom align=left width=\"200\" height=\"22\"><FONT color=#ffffff>&nbsp;ID</font>\n";
				echo "<IMG height=6 src=\"./images/border_orange.gif\" width=\"200\" border=0></TD>\n";
				echo "<TD vAlign=bottom align=left width=\"250\" height=\"22\"><FONT color=#ffffff>&nbsp;".$id."</font>\n";
				echo "<IMG height=6 src=\"./images/border_orange.gif\" width=\"250\" border=0></TD>\n";
				echo "<TD vAlign=bottom align=center width=\"30\" height=\"22\"><FONT color=#ffffff>?</font>\n";
				echo "<IMG height=6 src=\"./images/border_orange.gif\" width=\"25\" border=0></TD>\n";
				echo "</TR>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;HTTP PORT</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"http_port\" value=\"".$row['http_port']."\">\n";
				echo "<input type=\"checkbox\" name=\"http_port_disabled\" value=\"0\">&nbsp;disabled<br>\n</td>\n";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;ICP PORT</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"icp_port\" value=\"".$row['icp_port']."\">\n";
				echo "<input type=\"checkbox\" name=\"icp_port_disabled\" value=\"0\">&nbsp;disabled<br>\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;HTCP PORT</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"htcp_port\" value=\"".$row['htcp_port']."\">\n";
				echo "<input type=\"checkbox\" name=\"htcp_port_disabled\" value=\"0\">&nbsp;disabled<br>\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\" colspan=\"3\">&nbsp;</TD></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;TCP OUTGOING ADDRESS</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"tcp_outgoing_address\" value=\"".$row['tcp_outgoing_address']."\">\n";
				echo "<input type=\"checkbox\" name=\"tcp_outgoing_address_disabled\" value=\"0\">&nbsp;disabled<br>\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;UDP OUTGOING ADDRESS</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"udp_outgoing_address\" value=\"".$row['udp_outgoing_address']."\">\n";
				echo "<input type=\"checkbox\" name=\"udp_outgoing_address_disabled\" value=\"0\">&nbsp;disabled<br>\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;UDP INCOMING ADDRESS</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"udp_incoming_address\" value=\"".$row['udp_incoming_address']."\">\n";
				echo "<input type=\"checkbox\" name=\"udp_incoming_address_disabled\" value=\"0\">&nbsp;disabled<br>\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\" colspan=\"3\">&nbsp;</TD></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;CACHE MEMORY</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"cache_mem\" value=\"".$row['cache_mem']."\">\n";
				echo "<select name=\"cache_mem_divider\">\n";
				echo "<option value=\"1\">byte</option>\n";
				echo "<option value=\"1024\">kbyte</option>\n";
				echo "<option value=\"1048576\">mbyte</option>\n";
				echo "</select></td>\n";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;CACHE SWAP LOW</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"cache_swap_low\" value=\"".$row['cache_swap_low']."\">&nbsp;&nbsp;%\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;CACHE SWAP HIGH</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"cache_swap_high\" value=\"".$row['cache_swap_high']."\">&nbsp;&nbsp;%\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\" colspan=\"3\">&nbsp;</TD></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;MAXIMUM OBJECT SIZE</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"maximum_object_size\" value=\"".$row['maximum_object_size']."\">\n";
				echo "<select name=\"maximum_object_divider\">\n";
				echo "<option value=\"1\">byte</option>\n";
				echo "<option value=\"1024\">kbyte</option>\n";
				echo "<option value=\"1048576\">mbyte</option>\n";
				echo "</select></td>\n";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;MINIMUM OBJECT SIZE</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"minimum_object_size\" value=\"".$row['minimum_object_size']."\">\n";
				echo "<select name=\"minimum_object_size_divider\">\n";
				echo "<option value=\"1\">byte</option>\n";
				echo "<option value=\"1024\">kbyte</option>\n";
				echo "<option value=\"1048576\">mbyte</option>\n";
				echo "</select></td>\n";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;MAXIMUM OBJECT SIZE (MEM)</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"maximum_object_size_in_memory\" value=\"".$row['maximum_object_size_in_memory']."\">\n";
				echo "<select name=\"maximum_object_size_in_memory_divider\">\n";
				echo "<option value=\"1\">byte</option>\n";
				echo "<option value=\"1024\">kbyte</option>\n";
				echo "<option value=\"1048576\">mbyte</option>\n";
				echo "</select></td>\n";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\" colspan=\"3\">&nbsp;</TD></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;ICP QUERY TIMEOUT</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"icp_query_timeout\" value=\"".$row['icp_query_timeout']."\">&nbsp;&nbsp;msec\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;MAXIMUM ICP QUERY TIMEOUT</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"maximum_icp_query_timeout\" value=\"".$row['maximum_icp_query_timeout']."\">&nbsp;&nbsp;usec\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;MULTICAST ICP QUERY TIMEOUT</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"mcast_icp_query_timeout\" value=\"".$row['mcast_icp_query_timeout']."\">&nbsp;&nbsp;usec\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;DEAD PEER TIMEOUT</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"dead_peer_timeout\" value=\"".$row['dead_peer_timeout']."\">&nbsp;&nbsp;sec\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\" colspan=\"3\">&nbsp;</TD></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;IPCACHE SIZE</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"ipcache_size\" value=\"".$row['ipcache_size']."\">&nbsp;&nbsp;no. of entries\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;IPCACHE LOW (%)</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"ipcache_low\" value=\"".$row['ipcache_low']."\">&nbsp;&nbsp;%\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;IPCACHE HIGH (%)</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"ipcache_high\" value=\"".$row['ipcache_high']."\">&nbsp;&nbsp;%\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;FGDN CACHE SIZE</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<input type=text name=\"fgdn_cache_size\" value=\"".$row['fgdn_cache_size']."\">&nbsp;&nbsp;no. of entries\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\" colspan=\"3\">&nbsp;</TD></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;CACHE REPLACEMENT POLICY</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<select name=\"cache_replacement_policy\">\n";
				echo "<option value=\"0\">LRU</option>\n";
				echo "<option value=\"1\">HEAP GDSF</option>\n";
				echo "<option value=\"2\">HEAP LFUDA</option>\n";
				echo "<option value=\"3\">HEAP LRU</option>\n";
				echo "</select>\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;MEMORY REPLACEMENT POLICY</TD>\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\">\n";
				echo "&nbsp;&nbsp;<select name=\"cache_replacement_policy\">\n";
				echo "<option value=\"0\">LRU</option>\n";
				echo "<option value=\"1\">HEAP GDSF</option>\n";
				echo "<option value=\"2\">HEAP LFUDA</option>\n";
				echo "<option value=\"3\">HEAP LRU</option>\n";
				echo "</select>\n</td>";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td></tr>\n";
				
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=left width=\"\" height=\"22\" colspan=\"3\">&nbsp;</TD></tr>\n";
				
				# Submit Event Data
				echo "<TR bgColor=\"#d5d5d5\">\n";
				echo "<TD vAlign=middle align=center width=\"\" height=\"22\" colspan=\"3\">\n";
				echo "<input type=\"hidden\" value=\"".$sid."\" name=\"hiddenid\">\n";
				echo "<input type=\"hidden\" value=\"".$field."\" name=\"hiddenfield\">\n";
				echo "<input type=\"hidden\" name=\"rsubmit\">";
				echo "<a href=\"javascript:document.submitform.submit()\"><img src=\"./images/change.gif\" border=\"0\"></a>&nbsp;\n";
				echo "<a href=\"javascript:document.submitform.reset()\"><img src=\"./images/reset.gif\" border=\"0\"></a>&nbsp;\n";
				echo "<a href=\"".$PHP_SELF."?module=squid\"><img src=\"./images/icons/cancel.gif\" border=\"0\"></a>&nbsp;\n";
				echo "</TD>\n";
				echo "</TR>\n";
				
				echo "					</tbody>\n";						
				echo "					</table>\n";
				echo "				</td>\n";
				echo "			</tr>\n";
				echo "		</table>\n";
				echo "		</form>\n";
				echo "	<br><br><br>\n";
			}
			else
			{
				/*$result = mysql_query("update ".$tablename." set name='".$GLOBALS['name']."' where(id='".$GLOBALS['hiddenid']."')") or die(mysql_error());
				
				# Show Strategies (Default Mode)
				# -----------------------------------
				show_tbf($section, $section2, $tablename);
				break;
					}
					default :
					{
						break;
						# Select Type of Entry
						# ----------------------
						switch(substr($GLOBALS['sources'],0,1))
						{
							# Incorrect Value or Entry #
							case '-':
							{
								# Show Strategies (Default Mode)
								# -----------------------------------
								correct_priorities($section, $tablename);
								show_nat(0, $section, $section2, $tablename);
								break;
							}
							# Any #
							case '0':
							{
								# Update Entry for Any
								# -----------------------
								
								if (check_nat($tablename, $GLOBALS['hiddenfield'], $GLOBALS['sources'], $GLOBALS['hiddenid']) == 0)
								{
									$result = mysql_query("update ".$tablename." set ".substr($GLOBALS['hiddenfield'],0,1)."type='0' where(id='".$GLOBALS['hiddenid']."')") or die(mysql_error());
								}
								else
								{
									if (substr($GLOBALS['hiddenfield'],0,1) == 's')
										$result = mysql_query("update ".$tablename." set dtype='3' where(id='".$GLOBALS['hiddenid']."')") or die(mysql_error());
									else
										$result = mysql_query("update ".$tablename." set stype='3' where(id='".$GLOBALS['hiddenid']."')") or die(mysql_error());
										
									$result = mysql_query("update ".$tablename." set ".substr($GLOBALS['hiddenfield'],0,1)."type='0' where(id='".$GLOBALS['hiddenid']."')") or die(mysql_error());
								}
								
								# Show Strategies (Default Mode)
								# -----------------------------------
								correct_priorities($section, $tablename);
								show_nat(0, $section, $section2, $tablename);
								break;
							}
							# Network or Host #
							case '1':
							case '2':
							{
								# Update Entry for Network/Host
								# -----------------------------------
								
								if (check_nat($tablename, $GLOBALS['hiddenfield'], $GLOBALS['sources'], $GLOBALS['hiddenid']) == 0)
								{
									$result = mysql_query("delete from nat_layers where(pid='".$GLOBALS['hiddenid']."')");
									$result = mysql_query("update ".$tablename." set ".substr($GLOBALS['hiddenfield'],0,1)."type='".substr($GLOBALS['sources'],0,strpos($GLOBALS['sources'],"|"))."' where(id='".$GLOBALS['hiddenid']."')") or die(mysql_error());
								}
								else
								{
									if (substr($GLOBALS['hiddenfield'],0,1) == 's')
										$result = mysql_query("update ".$tablename." set dtype='3' where(id='".$GLOBALS['hiddenid']."')") or die(mysql_error());
									else
										$result = mysql_query("update ".$tablename." set stype='3' where(id='".$GLOBALS['hiddenid']."')") or die(mysql_error());
										
									$result = mysql_query("update ".$tablename." set ".substr($GLOBALS['hiddenfield'],0,1)."type='".substr($GLOBALS['sources'],0,strpos($GLOBALS['sources'],"|"))."' where(id='".$GLOBALS['hiddenid']."')") or die(mysql_error());
								}
								
								# Show Strategies (Default Mode)
								# -----------------------------------
								correct_priorities($section, $tablename);
								show_nat(0, $section, $section2, $tablename);
								break;
							}
						}
					}
				}*/
			}
		}
		
		/*
		* +-------------------------------------------+
		* | Show Squid Entry							|
		* +-------------------------------------------+
		* | Last Change : 28.02.2002       			|
		* +-------------------------------------------+
		* | Status : Enabled                   			|
		* +-------------------------------------------+
		*/
		function show_nidslog($section, $section2)
		{
			$result = mysql_query("SELECT COUNT(event.cid),MIN(event.timestamp),MAX(event.timestamp) FROM event");
			$result2 = mysql_query("SELECT DISTINCT signature FROM event");
			$result3 = mysql_query("SELECT ip_src FROM iphdr GROUP BY ip_src");
			$result4 = mysql_query("SELECT ip_dst FROM iphdr GROUP BY ip_dst");
			
			if($result2 != 0)
			{
				if(mysql_num_rows($result2) != 0)
					$tot_sig = mysql_num_rows($result2);
				else
					$tot_sig = 0;
			}
			
			if($result3 != 0)
			{
				if(mysql_num_rows($result3) != 0)
					$tot_dip = mysql_num_rows($result3);
				else
					$tot_dip = 0;
			}
			
			if($result4 != 0)
			{
				if(mysql_num_rows($result4) != 0)
					$tot_sip = mysql_num_rows($result4);
				else
					$tot_sip = 0;
			}
			
			if ($result != 0)
				$row = mysql_fetch_row($result);
			else
				print "Nothing Here\n";
			
			mysql_free_result($result);
			mysql_free_result($result2);
			mysql_free_result($result3);
			mysql_free_result($result4);
			
			echo "		<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" height=\"23px\">\n";
            echo "			<tr valign=\"top\">\n";
            echo "				<td align=\"left\" width=\"44px\" height=\"23px\" bgcolor=\"#E2E3DF\">\n";
            echo "					<img src=\"./images/tpx.gif\" width=\"44px\" height=\"23px\" border=\"0\"></td>\n";
			echo "				<td align=\"left\" height=\"23px\" bgcolor=\"#E2E3DF\">\n";
			echo " 	  				".$section2." (".$number.") &nbsp;</td>\n";
			echo "				<td align=\"left\" height=\"23px\" bgcolor=\"#E2E3DF\">\n";
            echo "					<img src=\"./images/tpx.gif\" width=\"200px\" height=\"23px\" border=\"0\"></td>\n";
			echo "			</tr>\n";
			echo "		</table>\n";
			
			echo "		<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n";
			echo "			<tr>\n";
			echo "				<td height=\"20px\" colspan=\"2\">\n";
			echo "					<img src=\"./images/tpx.gif\" id=\"blank\" border=\"0\" width=\"1px\" height=\"20px\"></td>\n";
			echo "			</tr>\n";
			echo "			<tr>\n";
			echo "				<td align=\"left\" width=\"40px\">\n";
			echo "					<img src=\"./images/tpx.gif\" width=\"40px\" height=\"1px\" border=\"0\"></td>\n";
			echo "				<td align=\"left\">\n";
			
			echo "					<TABLE cellSpacing=1 cellPadding=0 width=\"480\" border=0>\n";
			echo "						<TBODY>\n";
			echo "							<TR bgcolor=\"#565656\">\n";
			echo "								<TD vAlign=bottom align=left width=\"200\" height=\"22\"><FONT color=#ffffff>&nbsp;SUMMARY</font>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"200\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"250\" height=\"22\"><FONT color=#ffffff>&nbsp;".$id."</font>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"250\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=center width=\"30\" height=\"22\"><FONT color=#ffffff>?</font>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"25\" border=0></TD>\n";
			echo "							</TR>\n";
			
			echo "							<TR bgColor=\"#d5d5d5\">\n";
			echo "								<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;TOTAL EVENTS</TD>\n";
			echo "								<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;$row[0]</td>\n";
			echo "								<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td>\n";
			echo "							</tr>\n";
			
			echo "							<TR bgColor=\"#d5d5d5\">\n";
			echo "								<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;TIMESTAMP BEGINS @</TD>\n";
			echo "								<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;$row[1]</td>\n";
			echo "								<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td>\n";
			echo "							</tr>\n";
			
			echo "							<TR bgColor=\"#d5d5d5\">\n";
			echo "								<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;TIMESTAMP ENDS @</TD>\n";
			echo "								<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;$row[2]</td>\n";
			echo "								<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td>\n";
			echo "							</tr>\n";
			
			echo "							<TR bgColor=\"#d5d5d5\">\n";
			echo "								<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;TOTAL SIGNATURES</TD>\n";
			echo "								<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;$tot_sig</td>\n";
			echo "								<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td>\n";
			echo "							</tr>\n";
			
			echo "							<TR bgColor=\"#d5d5d5\">\n";
			echo "								<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;DESTINATION IPs OBSERVED</TD>\n";
			echo "								<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;$tot_dip</td>\n";
			echo "								<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td>\n";
			echo "							</tr>\n";
			
			echo "							<TR bgColor=\"#d5d5d5\">\n";
			echo "								<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;SOURCE IPs OBSERVED</TD>\n";
			echo "								<TD vAlign=middle align=left width=\"\" height=\"22\">&nbsp;$tot_sip</td>\n";
			echo "								<TD vAlign=middle align=center width=\"\" height=\"22\"><FONT color=#000000>?</font></td>\n";
			echo "							</tr>\n";
			
			echo "						</tbody>\n";
			echo "					</table>\n";
			
			echo "					<br><br><br>";
			
			echo "					<TABLE cellSpacing=1 cellPadding=0 width=650 border=0>\n";
			echo "						<TBODY>\n";
			echo "							<TR class=tablehead bgColor=#565656>\n";
			echo "								<TD vAlign=bottom align=left width=\"200\" height=\"22\"><FONT color=#ffffff>&nbsp;TIMESTAMP</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"200\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"150\" height=\"22\"><FONT color=#ffffff>&nbsp;SOURCE IP</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"150\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;S. PORT</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;D. PORT</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;SIGNATURE</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "							</TR>\n";
			
			$result = mysql_query("SELECT event.signature,event.timestamp,iphdr.ip_src,tcphdr.tcp_sport,tcphdr.tcp_dport FROM event,iphdr,tcphdr WHERE iphdr.sid = event.sid and iphdr.cid = event.cid and tcphdr.cid = event.cid ORDER BY event.timestamp DESC LIMIT 10");
			if (mysql_num_rows($result) != 0)
			{
				for ($i = 0; $i < mysql_num_rows($result); $i++ )
				{
					$row = mysql_fetch_row($result);
					echo "					<TR bgColor=#d5d5d5>\n";
					echo "						<TD vAlign=middle align=left width=\"200\" height=\"22\">&nbsp;$row[1]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"150\" height=\"22\">&nbsp;".long2ip($row[2])."</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$row[3]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$row[4]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$row[0]</TD>\n";
					echo "					</TR>\n";
				}
			}
			else
			{
				echo "					<TR bgColor=#d5d5d5>\n";
				echo "						<TD vAlign=middle align=left width=\"200\" height=\"22\" colspan=\"5\">Nothing there!</TD>\n";
				echo "					</TR>\n";
			}
			mysql_free_result($result);
			
			echo "						</tbody>\n";
			echo "					</table>\n";
			
			echo "					<br><br><br>";
			
			echo "					<TABLE cellSpacing=1 cellPadding=0 width=650 border=0>\n";
			echo "						<TBODY>\n";
			echo "							<TR class=tablehead bgColor=#565656>\n";
			echo "								<TD vAlign=bottom align=left width=\"200\" height=\"22\"><FONT color=#ffffff>&nbsp;TIMESTAMP</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"200\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"150\" height=\"22\"><FONT color=#ffffff>&nbsp;SOURCE IP</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"150\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;S. PORT</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;D. PORT</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;SIGNATURE</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "							</TR>\n";
			
			$result = mysql_query("SELECT event.signature,event.timestamp,iphdr.ip_src,udphdr.udp_sport,udphdr.udp_dport FROM event,iphdr,udphdr WHERE iphdr.sid = event.sid AND iphdr.cid = event.cid AND udphdr.sid = iphdr.sid AND udphdr.cid = iphdr.cid ORDER BY event.timestamp DESC LIMIT 10");
			if (mysql_num_rows($result) != 0)
			{
				for ($i = 0; $i < mysql_num_rows($result); $i++ )
				{
					$row = mysql_fetch_row($result);
					echo "					<TR bgColor=#d5d5d5>\n";
					echo "						<TD vAlign=middle align=left width=\"200\" height=\"22\">&nbsp;$row[1]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"150\" height=\"22\">&nbsp;".long2ip($row[2])."</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$row[3]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$row[4]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$row[0]</TD>\n";
					echo "					</TR>\n";
				}
			}
			else
			{
				echo "					<TR bgColor=#d5d5d5>\n";
				echo "						<TD vAlign=middle align=left width=\"200\" height=\"22\" colspan=\"5\">Nothing there!</TD>\n";
				echo "					</TR>\n";
			}
			mysql_free_result($result);
			
			echo "						</tbody>\n";
			echo "					</table>\n";
			
			echo "					<br><br><br>";
			
			echo "					<TABLE cellSpacing=1 cellPadding=0 width=650 border=0>\n";
			echo "						<TBODY>\n";
			echo "							<TR class=tablehead bgColor=#565656>\n";
			echo "								<TD vAlign=bottom align=left width=\"200\" height=\"22\"><FONT color=#ffffff>&nbsp;TIMESTAMP</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"200\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"150\" height=\"22\"><FONT color=#ffffff>&nbsp;SOURCE IP</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"150\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;TYPE</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;CODE</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;SIGNATURE</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "							</TR>\n";
			
			$result = mysql_query("SELECT event.signature,event.timestamp,iphdr.ip_src,icmphdr.icmp_type,icmphdr.icmp_code FROM event,iphdr,icmphdr WHERE iphdr.sid = event.sid AND iphdr.cid = event.cid AND icmphdr.sid = iphdr.sid AND icmphdr.cid = iphdr.cid ORDER BY event.timestamp DESC LIMIT 10");
			if (mysql_num_rows($result) != 0)
			{
				for ($i = 0; $i < mysql_num_rows($result); $i++ )
				{
					$row = mysql_fetch_row($result);
					echo "					<TR bgColor=#d5d5d5>\n";
					echo "						<TD vAlign=middle align=left width=\"200\" height=\"22\">&nbsp;$row[1]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"150\" height=\"22\">&nbsp;".long2ip($row[2])."</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$row[3]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$row[4]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$row[0]</TD>\n";
					echo "					</TR>\n";
				}
			}
			else
			{
				echo "					<TR bgColor=#d5d5d5>\n";
				echo "						<TD vAlign=middle align=left width=\"200\" height=\"22\" colspan=\"5\">Nothing there!</TD>\n";
				echo "					</TR>\n";
			}
			mysql_free_result($result);
			
			echo "						</tbody>\n";
			echo "					</table>\n";
			
			echo "					<br><br><br>";
			
			echo "					<TABLE cellSpacing=1 cellPadding=0 width=650 border=0>\n";
			echo "						<TBODY>\n";
			echo "							<TR class=tablehead bgColor=#565656>\n";
			echo "								<TD vAlign=bottom align=left width=\"200\" height=\"22\"><FONT color=#ffffff>&nbsp;NUMBERS</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"200\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"150\" height=\"22\"><FONT color=#ffffff>&nbsp;SIGNATURE</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"150\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;LATEST TIMESTAMP</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "							</TR>\n";
			
			$result = mysql_query("SELECT signature,COUNT(cid) as tot_id ,MAX(timestamp) FROM event GROUP BY signature ORDER BY tot_id DESC LIMIT 30");
			
			if ($result != 0)
			{
				for ($i = 0; $i < mysql_num_rows($result); $i++ )
				{
					$row = mysql_fetch_row($result);
					echo "					<TR bgColor=#d5d5d5>\n";
					echo "						<TD vAlign=middle align=left width=\"200\" height=\"22\">&nbsp;$row[1]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"150\" height=\"22\">&nbsp;$row[0]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$row[2]</TD>\n";
					echo "					</TR>\n";
				}
			}
			else
			{
				echo "					<TR bgColor=#d5d5d5>\n";
				echo "						<TD vAlign=middle align=left width=\"200\" height=\"22\" colspan=\"5\">Nothing there!</TD>\n";
				echo "					</TR>\n";
			}
			
			mysql_free_result($result);
			
			echo "						</tbody>\n";
			echo "					</table>\n";
			
			echo "					<br><br><br>";
			
			echo "					<TABLE cellSpacing=1 cellPadding=0 width=650 border=0>\n";
			echo "						<TBODY>\n";
			echo "							<TR class=tablehead bgColor=#565656>\n";
			echo "								<TD vAlign=bottom align=left width=\"200\" height=\"22\"><FONT color=#ffffff>&nbsp;REPORTS</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"200\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"150\" height=\"22\"><FONT color=#ffffff>&nbsp;SOURCE IP</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"150\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;SIGNATURE</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;FREQUENCY</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;FIRST TIMESTAMP</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "							</TR>\n";
			
			$result = mysql_query("SELECT iphdr.ip_src,COUNT(iphdr.cid) as total,event.signature,MAX(event.timestamp), MIN(event.timestamp), UNIX_TIMESTAMP(MAX(event.timestamp)) - UNIX_TIMESTAMP(MIN(event.timestamp)) FROM iphdr,event WHERE event.sid = iphdr.sid AND event.cid = iphdr.cid GROUP BY iphdr.ip_src,event.signature ORDER BY total DESC LIMIT 30");
			
			if ($result !=0 )
			{
				for ($i = 0; $i < mysql_num_rows($result); $i++ )
				{
					$row = mysql_fetch_row($result);
					$freq = $row[5] / $row[4];
					echo "					<TR bgColor=#d5d5d5>\n";
					echo "						<TD vAlign=middle align=left width=\"200\" height=\"22\">&nbsp;$row[4]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"150\" height=\"22\">&nbsp;".long2ip($row[0])."]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;Once every $freq seconds</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$row[2]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$row[3]</TD>\n";
					echo "					</TR>\n";
				}
			}
			else
			{
				echo "					<TR bgColor=#d5d5d5>\n";
				echo "						<TD vAlign=middle align=left width=\"200\" height=\"22\" colspan=\"5\">Nothing there!</TD>\n";
				echo "					</TR>\n";
			}
			
			mysql_free_result($result);
			
			echo "						</tbody>\n";
			echo "					</table>\n";
			
			echo "					<br><br><br>";
			
			echo "					<TABLE cellSpacing=1 cellPadding=0 width=650 border=0>\n";
			echo "						<TBODY>\n";
			echo "							<TR class=tablehead bgColor=#565656>\n";
			echo "								<TD vAlign=bottom align=left width=\"200\" height=\"22\"><FONT color=#ffffff>&nbsp;REPORTS</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"200\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"150\" height=\"22\"><FONT color=#ffffff>&nbsp;STARTED @</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"150\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;SOURCE IP</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;LAST RECORDED TIMESTAMP</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;SIGNATURE</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "								<TD vAlign=bottom align=left width=\"100\" height=\"22\"><FONT color=#ffffff>&nbsp;FREQUENCY</FONT>\n";
			echo "									<IMG height=6 src=\"./images/border_orange.gif\" width=\"100\" border=0></TD>\n";
			echo "							</TR>\n";
			
			//$result = mysql_query("SELECT event.signature,MIN(event.timestamp),MAX(event.timestamp),iphdr.ip_src,COUNT(iphdr.cid) as total, UNIX_TIMESTAMP(MAX(event.timestamp))-UNIX_TIMESTAMP(MIN(event.timestamp)) FROM event,iphdr WHERE iphdr.ip_dst = $c00lip AND event.sid = iphdr.sid AND event.cid=iphdr.cid GROUP BY iphdr.ip_src,event.signature ORDER BY total DESC LIMIT 30");
			//$result = mysql_query("SELECT event.signature,MIN(event.timestamp),MAX(event.timestamp),iphdr.ip_src,COUNT(iphdr.cid) as total, UNIX_TIMESTAMP(MAX(event.timestamp))-UNIX_TIMESTAMP(MIN(event.timestamp)) FROM event,iphdr WHERE event.sid = iphdr.sid AND event.cid=iphdr.cid GROUP BY iphdr.ip_src,event.signature ORDER BY total DESC LIMIT 30");
			$result = mysql_query("SELECT signature.sig_name,MIN(event.timestamp),MAX(event.timestamp),iphdr.ip_src,COUNT(iphdr.cid) as total, UNIX_TIMESTAMP(MAX(event.timestamp))-UNIX_TIMESTAMP(MIN(event.timestamp)) FROM event,iphdr,signature WHERE event.sid = iphdr.sid AND event.cid=iphdr.cid AND event.signature=signature.sig_id GROUP BY iphdr.ip_src,event.signature ORDER BY total DESC LIMIT 30");
			if ($result != 0)
			{
				for ($i = 0; $i < mysql_num_rows($result); $i++ )
				{
					$row = mysql_fetch_row($result);
					//$freq = $row[1] / $row[2];
					echo "					<TR bgColor=#d5d5d5>\n";
					echo "						<TD vAlign=middle align=left width=\"200\" height=\"22\">&nbsp;$row[4]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"150\" height=\"22\">&nbsp;$row[1]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;".long2ip($row[3])."</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$row[2]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$row[0]</TD>\n";
					echo "						<TD vAlign=middle align=left width=\"100\" height=\"22\">&nbsp;$freq</TD>\n";
					echo "					</TR>\n";
				}
			}
			else
			{
				echo "					<TR bgColor=#d5d5d5>\n";
				echo "						<TD vAlign=middle align=left width=\"200\" height=\"22\" colspan=\"6\">Nothing there!</TD>\n";
				echo "					</TR>\n";
			}
			mysql_free_result($result);
			
			echo "						</tbody>\n";
			echo "					</table>\n";
			
			echo "				</td>\n";
			echo "			</tr>\n";
			echo "		</table>\n";
			echo "	<br><br><br>\n";
		}
		
        // -------------------------------------
		// | Change NAT Status (Sub,Main) |
		// -------------------------------------
		// | Last Change : 10.01.2002       |
		// -------------------------------------
		// | Status : Enabled                   |
		// -------------------------------------
		function status_tbf($section, $section2, $tablename, $tablename2, $id)
		{
			# Changes the status (without prompt) of the selected
			# NAT Entry. No Return Value. Redirects to rearrange function.
			$result = mysql_query("select * from ".$tablename." where (id='".$id."')") or die(mysql_error());
			
			# Get Currente Status of Entry
			# ---------------------------------
			$row = mysql_fetch_array($result);
			
			# Select Status of Entry
			# -------------------------
			if ($row['status'] == 0)
			{
				# Set Status of Entry == 1
				# ---------------------------
				$result = mysql_query("update ".$tablename." set status=1 where (id='".$id."')") or die(mysql_error());
			}
			else
			{
				# Set Status of Entry == 0
				# ---------------------------
				$result = mysql_query("update ".$tablename." set status=0 where (id='".$id."')") or die(mysql_error());
			}
			
			show_tbf($section, $section2, $tablename);
		}
		
?>